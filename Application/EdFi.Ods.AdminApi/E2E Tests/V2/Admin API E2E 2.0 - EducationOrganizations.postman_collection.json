{
	"info": {
		"_postman_id": "a8b7c9d2-5e4f-4a3b-9c8d-7e6f5a4b3c2d",
		"name": "Admin API E2E 2.0 - EducationOrganizations",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "22794466"
	},
	"item": [
		{
			"name": "v2",
			"item": [
				{
					"name": "EducationOrganizations",
					"item": [
						{
							"name": "EducationOrganizations - GET All",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"GET EducationOrganizations: Status code is OK\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"GET EducationOrganizations: Response is an array\", function () {",
											"    pm.expect(response).to.be.an('array');",
											"});",
											"",
											"pm.test(\"GET EducationOrganizations: Response matches success format\", function () {",
											"    if (response.length > 0) {",
											"        pm.expect(response[0]).to.have.property(\"educationOrganizationId\");",
											"        pm.expect(response[0]).to.have.property(\"nameOfInstitution\");",
											"        pm.expect(response[0]).to.have.property(\"discriminator\");",
											"        pm.expect(response[0]).to.have.property(\"instanceId\");",
											"        pm.expect(response[0]).to.have.property(\"instanceName\");",
											"    }",
											"});",
											"",
											"const GetEducationOrganizationsSchema = {",
											"  \"type\": \"array\",",
											"  \"items\": {",
											"    \"type\": \"object\",",
											"    \"properties\": {",
											"      \"educationOrganizationId\": {",
											"        \"type\": \"integer\"",
											"      },",
											"      \"nameOfInstitution\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"shortNameOfInstitution\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"discriminator\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"parentId\": {",
											"        \"type\": [\"integer\", \"null\"]",
											"      },",
											"      \"instanceId\": {",
											"        \"type\": \"integer\"",
											"      },",
											"      \"instanceName\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"odsDatabaseName\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"lastRefreshed\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"lastModifiedDate\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      }",
											"    },",
											"    \"required\": [",
											"      \"educationOrganizationId\",",
											"      \"instanceId\"",
											"    ]",
											"  }",
											"}",
											"",
											"pm.test(\"GET EducationOrganizations: Validation Schema Response\", () => {",
											"    pm.response.to.have.jsonSchema(GetEducationOrganizationsSchema);",
											"});",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v2/educationOrganizations",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v2",
										"educationOrganizations"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - Invalid Api Mode",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"GET EducationOrganizations Invalid Api Mode: Status code is Bad Request\", function () {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"GET EducationOrganizations Invalid Api Mode: Response matches error format\", function () {",
											"    pm.expect(response).to.have.property(\"message\");",
											"});",
											"",
											"pm.test(\"GET EducationOrganizations Invalid Api Mode: Response title is helpful and accurate\", function () {",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"wrong api version for this instance mode.\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v1/educationOrganizations",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v1",
										"educationOrganizations"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - GET By Instance",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"let header = {",
											"    \"Content-Type\": \"application/json\",",
											"    \"Authorization\": `Bearer ${pm.collectionVariables.get(\"TOKEN\")}`",
											"};",
											"",
											"if (pm.variables.get(\"isMultitenant\") == \"true\") {",
											"    header['Tenant'] = `${pm.variables.get(\"tenant1\")}`;",
											"}",
											"",
											"pm.sendRequest({",
											"  url: `${pm.variables.get(\"API_URL\")}/v2/odsInstances?offset=0&limit=1`,",
											"  method: 'GET',",
											"  header: header",
											"},",
											"function (err, response) {",
											"  if(err) { console.log(\"Error in Pre-request:\", err); }",
											"  const json = response.json();",
											"  if(!json[0] || !json[0].id) { ",
											"    console.log('Error in Pre-request: odsInstanceId missing from response. Response is:', json); ",
											"  }",
											"  else {",
											"    pm.collectionVariables.set(\"TestInstanceId\", json[0].id);",
											"  }",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"GET EducationOrganizations By Instance: Status code is OK\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"GET EducationOrganizations By Instance: Response is an array\", function () {",
											"    pm.expect(response).to.be.an('array');",
											"});",
											"",
											"pm.test(\"GET EducationOrganizations By Instance: Response matches success format\", function () {",
											"    if (response.length > 0) {",
											"        pm.expect(response[0]).to.have.property(\"educationOrganizationId\");",
											"        pm.expect(response[0]).to.have.property(\"nameOfInstitution\");",
											"        pm.expect(response[0]).to.have.property(\"discriminator\");",
											"        pm.expect(response[0]).to.have.property(\"instanceId\");",
											"        pm.expect(response[0].instanceId).to.equal(parseInt(pm.collectionVariables.get(\"TestInstanceId\")));",
											"    }",
											"});",
											"",
											"const GetEducationOrganizationsByInstanceSchema = {",
											"  \"type\": \"array\",",
											"  \"items\": {",
											"    \"type\": \"object\",",
											"    \"properties\": {",
											"      \"educationOrganizationId\": {",
											"        \"type\": \"integer\"",
											"      },",
											"      \"nameOfInstitution\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"shortNameOfInstitution\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"discriminator\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"parentId\": {",
											"        \"type\": [\"integer\", \"null\"]",
											"      },",
											"      \"instanceId\": {",
											"        \"type\": \"integer\"",
											"      },",
											"      \"instanceName\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"odsDatabaseName\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"lastRefreshed\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      },",
											"      \"lastModifiedDate\": {",
											"        \"type\": [\"string\", \"null\"]",
											"      }",
											"    },",
											"    \"required\": [",
											"      \"educationOrganizationId\",",
											"      \"instanceId\"",
											"    ]",
											"  }",
											"}",
											"",
											"pm.test(\"GET EducationOrganizations By Instance: Validation Schema Response\", () => {",
											"    pm.response.to.have.jsonSchema(GetEducationOrganizationsByInstanceSchema);",
											"});",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v2/educationOrganizations/{{TestInstanceId}}",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v2",
										"educationOrganizations",
										"{{TestInstanceId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - GET By Instance - Invalid Api Mode",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"GET EducationOrganizations By Instance Invalid Api Mode: Status code is Bad Request\", function () {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"GET EducationOrganizations By Instance Invalid Api Mode: Response matches error format\", function () {",
											"    pm.expect(response).to.have.property(\"message\");",
											"});",
											"",
											"pm.test(\"GET EducationOrganizations By Instance Invalid Api Mode: Response title is helpful and accurate\", function () {",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"wrong api version for this instance mode.\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v1/educationOrganizations/{{TestInstanceId}}",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v1",
										"educationOrganizations",
										"{{TestInstanceId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - GET By Instance - Not Found",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"function randomIntFromInterval(min, max) {",
											"  return Math.floor(Math.random() * (max - min + 1) + min)",
											"}",
											"",
											"const rndInt = randomIntFromInterval(99990, 99999)",
											"pm.collectionVariables.set(\"NonExistentInstanceId\", pm.variables.replaceIn(rndInt));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"GET EducationOrganizations By Instance Not Found: Status code is Not Found\", function () {",
											"    pm.response.to.have.status(404);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"GET EducationOrganizations By Instance Not Found: Response has error details\", function () {",
											"    pm.expect(response).to.have.property(\"title\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v2/educationOrganizations/{{NonExistentInstanceId}}",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v2",
										"educationOrganizations",
										"{{NonExistentInstanceId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - Refresh All",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"POST EducationOrganizations Refresh All: Status code is Accepted\", function () {",
											"    pm.response.to.have.status(202);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"POST EducationOrganizations Refresh All: Response matches success format\", function () {",
											"    pm.expect(response).to.have.property(\"message\");",
											"});",
											"",
											"pm.test(\"POST EducationOrganizations Refresh All: Response message is helpful\", function () {",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"queued\");",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"all instances\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v2/educationOrganizations/refresh",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v2",
										"educationOrganizations",
										"refresh"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - Refresh All - Invalid Api Mode",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"POST EducationOrganizations Refresh All Invalid Api Mode: Status code is Bad Request\", function () {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"POST EducationOrganizations Refresh All Invalid Api Mode: Response matches error format\", function () {",
											"    pm.expect(response).to.have.property(\"message\");",
											"});",
											"",
											"pm.test(\"POST EducationOrganizations Refresh All Invalid Api Mode: Response title is helpful and accurate\", function () {",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"wrong api version for this instance mode.\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v1/educationOrganizations/refresh",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v1",
										"educationOrganizations",
										"refresh"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - Refresh By Instance",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"let header = {",
											"    \"Content-Type\": \"application/json\",",
											"    \"Authorization\": `Bearer ${pm.collectionVariables.get(\"TOKEN\")}`",
											"};",
											"",
											"if (pm.variables.get(\"isMultitenant\") == \"true\") {",
											"    header['Tenant'] = `${pm.variables.get(\"tenant1\")}`;",
											"}",
											"",
											"pm.sendRequest({",
											"  url: `${pm.variables.get(\"API_URL\")}/v2/odsInstances?offset=0&limit=1`,",
											"  method: 'GET',",
											"  header: header",
											"},",
											"function (err, response) {",
											"  if(err) { console.log(\"Error in Pre-request:\", err); }",
											"  const json = response.json();",
											"  if(!json[0] || !json[0].id) { ",
											"    console.log('Error in Pre-request: odsInstanceId missing from response. Response is:', json); ",
											"  }",
											"  else {",
											"    pm.collectionVariables.set(\"TestInstanceId\", json[0].id);",
											"  }",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"POST EducationOrganizations Refresh By Instance: Status code is Accepted\", function () {",
											"    pm.response.to.have.status(202);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"POST EducationOrganizations Refresh By Instance: Response matches success format\", function () {",
											"    pm.expect(response).to.have.property(\"message\");",
											"});",
											"",
											"pm.test(\"POST EducationOrganizations Refresh By Instance: Response message is helpful\", function () {",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"queued\");",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"instance\");",
											"    pm.expect(response.message).to.contain(pm.collectionVariables.get(\"TestInstanceId\"));",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v2/educationOrganizations/refresh/{{TestInstanceId}}",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v2",
										"educationOrganizations",
										"refresh",
										"{{TestInstanceId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - Refresh By Instance - Invalid Api Mode",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"POST EducationOrganizations Refresh By Instance Invalid Api Mode: Status code is Bad Request\", function () {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"POST EducationOrganizations Refresh By Instance Invalid Api Mode: Response matches error format\", function () {",
											"    pm.expect(response).to.have.property(\"message\");",
											"});",
											"",
											"pm.test(\"POST EducationOrganizations Refresh By Instance Invalid Api Mode: Response title is helpful and accurate\", function () {",
											"    pm.expect(response.message.toLowerCase()).to.contain(\"wrong api version for this instance mode.\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v1/educationOrganizations/refresh/{{TestInstanceId}}",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v1",
										"educationOrganizations",
										"refresh",
										"{{TestInstanceId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "EducationOrganizations - Refresh By Instance - Non-Existent Instance",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"function randomIntFromInterval(min, max) {",
											"  return Math.floor(Math.random() * (max - min + 1) + min)",
											"}",
											"",
											"const rndInt = randomIntFromInterval(99990, 99999)",
											"pm.collectionVariables.set(\"NonExistentInstanceId\", pm.variables.replaceIn(rndInt));"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"POST EducationOrganizations Refresh By Non-Existent Instance: Status code is Not Found\", function () {",
											"    pm.response.to.have.status(404);",
											"});",
											"",
											"const response = pm.response.json();",
											"",
											"pm.test(\"POST EducationOrganizations Refresh By Non-Existent Instance: Response has error details\", function () {",
											"    pm.expect(response).to.have.property(\"title\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{API_URL}}/v2/educationOrganizations/refresh/{{NonExistentInstanceId}}",
									"host": [
										"{{API_URL}}"
									],
									"path": [
										"v2",
										"educationOrganizations",
										"refresh",
										"{{NonExistentInstanceId}}"
									]
								}
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					]
				}
			]
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{TOKEN}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"function generateClientSecret() {",
					"    const minLength = 32;",
					"    const maxLength = 128;",
					"    let result = '';",
					"    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';",
					"    const specialCharacters = '!@#$%^&*()_+{}:\"<>?|[];\\',./`~';",
					"    const length = Math.floor(Math.random() * (maxLength - minLength + 1)) + minLength;",
					"",
					"    result += randomChar('abcdefghijklmnopqrstuvwxyz');",
					"    result += randomChar('ABCDEFGHIJKLMNOPQRSTUVWXYZ');",
					"    result += randomChar('0123456789');",
					"    result += randomChar(specialCharacters);",
					"",
					"    for (let i = result.length; i < length; i++) {",
					"        const charactersPlusSpecial = characters + specialCharacters;",
					"        result += charactersPlusSpecial.charAt(Math.floor(Math.random() * charactersPlusSpecial.length));",
					"    }",
					"",
					"    return shuffleString(result);",
					"}",
					"",
					"function randomChar(str) {",
					"    return str.charAt(Math.floor(Math.random() * str.length));",
					"}",
					"",
					"function shuffleString(str) {",
					"    const array = str.split('');",
					"    for (let i = array.length - 1; i > 0; i--) {",
					"        const j = Math.floor(Math.random() * (i + 1));",
					"        [array[i], array[j]] = [array[j], array[i]];",
					"    }",
					"    return array.join('');",
					"}",
					"",
					"let guid = pm.variables.replaceIn('{{$guid}}');",
					"let client_secret =  generateClientSecret();",
					"",
					"let header = {",
					"    'Content-Type': 'application/x-www-form-urlencoded'",
					"};",
					"",
					"if (pm.variables.get(\"isMultitenant\") == \"true\") {",
					"    header['Tenant'] = `${pm.variables.get(\"tenant1\")}`;",
					"    pm.request.headers.upsert({key: 'Tenant', value: `${pm.variables.get(\"tenant1\")}` });",
					"}",
					"",
					"pm.sendRequest({",
					"    url: `${pm.variables.get(\"API_URL\")}/connect/register`,",
					"    method: 'POST',",
					"    header: header,",
					"    body: {",
					"        mode: 'urlencoded',",
					"        urlencoded: [",
					"            {key: 'ClientId', value: guid },",
					"            {key: 'ClientSecret', value: client_secret },",
					"            {key: 'DisplayName', value: guid }",
					"        ]",
					"    }",
					"},",
					"    (err, res) => {",
					"        error = res.json().error",
					"        if(error) {",
					"            throw res.json().error_description",
					"        }",
					"",
					"pm.sendRequest({",
					"    url: `${pm.variables.get(\"API_URL\")}/connect/token`,",
					"    method: 'POST',",
					"    header: header,",
					"    body: {",
					"        mode: 'urlencoded',",
					"        urlencoded: [",
					"            {key: 'client_id', value: guid },",
					"            {key: 'client_secret', value: client_secret },",
					"            {key: 'grant_type', value: \"client_credentials\"},",
					"            {key: 'scope', value: \"edfi_admin_api/full_access\"}",
					"        ]",
					"    }",
					"},",
					"    (err, res) => {",
					"        error = res.json().error",
					"        if(error) {",
					"            throw res.json().error_description",
					"        }",
					"        pm.collectionVariables.set(\"TOKEN\", res.json().access_token)",
					"});",
					"});"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "TOKEN",
			"value": ""
		},
		{
			"key": "TestInstanceId",
			"value": ""
		},
		{
			"key": "NonExistentInstanceId",
			"value": ""
		}
	]
}
